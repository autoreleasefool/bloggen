#!/bin/bash

blog_name='runcode.blog'
publish_time=`date +%m-%d-%Y`

for arg in "$@"
do
  case $arg in
    -d|--dry-run)
    DRY_RUN=1
    shift
    ;;
  esac
done

mkdir -p tmp
mv ../runcode.blog/tags/tags_index.html tmp/tags_index.html

./bin/bloggen \
  $blog_name \
  /Users/josephroque/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/Personal/Writing/Blog\ Posts \
  /Users/josephroque/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/Personal/Attachments/runcode.blog \
  /Users/josephroque/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/Personal/Projects/Personal\ Blog/runcode.blog\ tags.md \
  ../$blog_name

mv tmp/tags_index.html ../runcode.blog/tags/tags_index.html
rm -rf tmp

if [[ "$DRY_RUN" -eq 1 ]]; then
  echo "Not publishing, exiting"
  exit 0
fi

pushd ../$blog_name
if [[ `git status --porcelain` ]]; then
  git add .
  git commit -m "bloggen: publish $blog_name, $publish_time"
  git push origin main
  echo "Published changes"
else
  echo "No changes"
fi
popd
